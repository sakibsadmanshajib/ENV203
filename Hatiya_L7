/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var images = ee.ImageCollection("LANDSAT/LE07/C01/T1_RT"),
    builtup = /* color: #8b0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[91.0632730449314, 22.153805087085093],
                  [91.06391677509498, 22.152731910875],
                  [91.06940993915748, 22.153328120890976],
                  [91.06940993915748, 22.153964075457218]]]),
            {
              "class": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.09271297107887, 22.15515648252251],
                  [91.09202632557106, 22.153964075457218],
                  [91.09357127796363, 22.153884581293603]]]),
            {
              "class": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.06160871969439, 22.153834208666503],
                  [91.06153361784197, 22.153257874431066],
                  [91.06164090620257, 22.153257874431066],
                  [91.06176965223528, 22.153625536198675],
                  [91.06248848425128, 22.15356591543676],
                  [91.06256358610369, 22.153883892541803]]]),
            {
              "class": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13903188852191, 22.29102775700167],
                  [91.13950395730853, 22.28999533886685],
                  [91.13993311075092, 22.290670382356478],
                  [91.14044809488178, 22.29047184049209],
                  [91.14152097848773, 22.290233589882533],
                  [91.14220762399555, 22.290590965644558],
                  [91.14134931711078, 22.2914645469937],
                  [91.14014768747211, 22.291821919608214],
                  [91.13971853402973, 22.290908632221466]]]),
            {
              "class": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14225053933978, 22.290670382356478],
                  [91.14735746530414, 22.28928058338312],
                  [91.14774370340228, 22.290193881408122]]]),
            {
              "class": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.1112366646064, 22.312207162773777],
                  [91.11145124132759, 22.31210790718059],
                  [91.1125884979499, 22.31280269485106],
                  [91.11233100588447, 22.313040906970684],
                  [91.11119374926216, 22.31234612048568]]]),
            {
              "class": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.1391703078582, 22.31481779961304],
                  [91.13921322320243, 22.314371157240167],
                  [91.13949217293998, 22.314450560433126]]]),
            {
              "class": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14047922585746, 22.313676377375348],
                  [91.14089765046378, 22.312525020272496],
                  [91.14176668618461, 22.312574647929644],
                  [91.14116587136527, 22.313755780963483]]]),
            {
              "class": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.1429361293151, 22.31634629825349],
                  [91.14318289254447, 22.315224739197525],
                  [91.14369787667533, 22.315284291232352],
                  [91.14361204598686, 22.316475326593455]]]),
            {
              "class": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13737859223625, 22.31339846446126],
                  [91.13732494805595, 22.313100700010818],
                  [91.13758244012138, 22.313080849024878],
                  [91.13763608430168, 22.313319060669915]]]),
            {
              "class": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13978185151359, 22.306698610727473],
                  [91.13959946130058, 22.30666883288223],
                  [91.139674563153, 22.3059740146908],
                  [91.13984622452995, 22.30601371868058]]]),
            {
              "class": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13482778460127, 22.301367017096776],
                  [91.13444154650313, 22.301307459126555],
                  [91.13455956369978, 22.300622540643957],
                  [91.13483851343733, 22.30075158351337]]]),
            {
              "class": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13904421717268, 22.30014607363201],
                  [91.13905494600874, 22.299719237220508],
                  [91.13936608225447, 22.299729163663503],
                  [91.13934462458235, 22.300175852867866]]]),
            {
              "class": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14078228861433, 22.2997887223066],
                  [91.14080374628645, 22.299441296530546],
                  [91.14125435740095, 22.299361884803282],
                  [91.14115779787642, 22.299530634669775],
                  [91.14101832300764, 22.299828428054564]]]),
            {
              "class": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14077155977827, 22.303530939459115],
                  [91.14076083094221, 22.303004851326865],
                  [91.14114706904036, 22.303004851326865],
                  [91.14101832300764, 22.303501160938488]]]),
            {
              "class": 0,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14043129377797, 22.29702914517723],
                  [91.14044202261402, 22.296592372577944],
                  [91.14094627790882, 22.296612225907534],
                  [91.14104283743336, 22.29702914517723]]]),
            {
              "class": 0,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13988412313893, 22.296512959231386],
                  [91.13960517340138, 22.29598684467043],
                  [91.14027036123707, 22.295589775765556],
                  [91.14021671705677, 22.29665193255824]]]),
            {
              "class": 0,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13955152922108, 22.292095520750767],
                  [91.1399163096471, 22.291450265239874],
                  [91.14034546308949, 22.292581942166503]]]),
            {
              "class": 0,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14027036123707, 22.294418415922294],
                  [91.14001286917164, 22.29442834274187],
                  [91.1401308863683, 22.2930882157195]]]),
            {
              "class": 0,
              "system:index": "18"
            })]),
    nonbuiltup = /* color: #07ff5f */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[91.11226663286811, 22.335533963283012],
                  [91.11333951647407, 22.32731673481376],
                  [91.11372575457222, 22.322552902470825],
                  [91.12286672289497, 22.320825973081927],
                  [91.12790927584297, 22.323267487690906],
                  [91.12904653246528, 22.32558986438311],
                  [91.12790927584297, 22.329639044104923],
                  [91.1277161567939, 22.331226925639026],
                  [91.1280594795478, 22.338729421386283]]]),
            {
              "class": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.11198768313056, 22.33585152761367],
                  [91.11977681810981, 22.336863759091358],
                  [91.1195407837165, 22.338530947860573],
                  [91.1175237625373, 22.3376576609913],
                  [91.1146055191291, 22.338729421386283],
                  [91.11299619372016, 22.336625587639997],
                  [91.11162290270454, 22.337340100773726]]]),
            {
              "class": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.10441312487251, 22.340436282044912],
                  [91.10445604021675, 22.336208786621263],
                  [91.11155852968818, 22.33571259330799],
                  [91.1105714767707, 22.34416748606333]]]),
            {
              "class": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.09583005602485, 22.336605740000685],
                  [91.09507903750068, 22.331207077231426],
                  [91.09898433382637, 22.33088950232546],
                  [91.10102281267768, 22.334382786522365],
                  [91.10063657457954, 22.33684391148595]]]),
            {
              "class": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.13841928933402, 22.305755642545268],
                  [91.13888062928459, 22.304782889748957],
                  [91.13974966500541, 22.305001263415427],
                  [91.13970674966117, 22.305835050637707],
                  [91.13834418748161, 22.305725864498978]]]),
            {
              "class": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.10466189073134, 22.280368200143684],
                  [91.10290236161757, 22.271274023436312],
                  [91.11689276383925, 22.268216023335494],
                  [91.12393088029432, 22.277508959406628]]]),
            {
              "class": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.12942404435682, 22.278025215530924],
                  [91.10938257859755, 22.262655851929956],
                  [91.13890833543348, 22.261861523695927]]]),
            {
              "class": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.14937967942762, 22.281678665944064],
                  [91.14534563706923, 22.26209982263948],
                  [91.16508669541884, 22.263492232634515],
                  [91.16512961076307, 22.28334885432399]]]),
            {
              "class": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.177051314545, 22.30194095578953],
                  [91.17087150497468, 22.203437538046952],
                  [91.1883809654239, 22.235855987218944],
                  [91.18803764267, 22.263818821405685],
                  [91.18323112411531, 22.277162750679768],
                  [91.18563438339265, 22.290187739451245]]]),
            {
              "class": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.07336784286531, 22.387360261827027],
                  [91.0675313560489, 22.331160882410156],
                  [91.09156394882234, 22.332748746620044],
                  [91.11284995956453, 22.389582369887997]]]),
            {
              "class": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[91.06209235285132, 22.30997154061768],
                  [91.04492621515601, 22.259778114112756],
                  [91.09539465998023, 22.216877060571395],
                  [91.10054450128882, 22.301713101792792]]]),
            {
              "class": 1,
              "system:index": "10"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//Visual Parameters for RGB composite of Landsat 7
var visParamsRGB_L7 = {bands: ['B3', 'B2', 'B1']};

//Visual Parameters for False Color composite for Landsat 5
// var visParamsFalse_L5 = {bands: ['B4', 'B3', 'B2'], max: 0.3};

var calculate = function(name, areaname, ULY, ULX, LRY, LRX){
/*
ULX = Upper left longitude
ULY = Upper left latitude
LRX = Lower right longitude
LRY = Lower right latitude

*/
  print("Hello, " + name +'.');
  var roi = ee.Geometry.Polygon([
    [[ULX,ULY], [LRX, ULY], [LRX,LRY], [ULX,LRY]]
  ]);
  Map.setCenter(ULX,ULY,11);
  var unclipped = images.filterBounds(roi);
  
  // var unclipped_1991 = ee.ImageCollection(unclipped
  //   .filterDate('1991-01-01','1992-01-01')
  //   .sort('CLOUD_COVER')
  //   .first()
  // );
  var unclipped_2001 = ee.ImageCollection(unclipped
    .filterDate('2001-01-01','2002-01-01')
    .sort('CLOUD_COVER')
    // .first()
  );
  var unclipped_2011 = ee.ImageCollection(unclipped
    .filterDate('2011-01-01','2012-01-01')
    .sort('CLOUD_COVER')
    // .first()
  );
  
  // STEP 1 : START OF IMAGE COLLECTION
  // print('1991',unclipped_1991);
  print('2001',unclipped_2001);
  print('2011',unclipped_2011);
  
 //COMMENT OUT AT THE TIME OF IMAGE COLLECTION
  Map.addLayer(roi);
  
  // var image1991 = ee.Image('LANDSAT/LT05/C01/T1_TOA/LT05_137043_19910126').clip(roi); 
  // Map.addLayer(image1991,visParamsRGB_L5,'1991');
 
  var image2001 = ee.Image('LANDSAT/LE07/C01/T1_RT/LE07_137045_20011129').clip(roi); 
  Map.addLayer(image2001,visParamsRGB_L7,'2001');
 
  var image2011 = ee.Image('LANDSAT/LE07/C01/T1_RT/LE07_136045_20111102').clip(roi); 
  Map.addLayer(image2011,visParamsRGB_L7,'2011');
  
/* 
  STEP 3 : TRAINING DATA
  Do in only on 1991 image. Uncheck 2001 and 2011 images. Create FeatureCollection, add class label and class values

*/

  // Use these bands for prediction.
  var bands = ['B1', 'B2', 'B3', 'B4', 'B5', 'B6_VCID_1', 'B6_VCID_2', 'B7', 'B8'];

  // Load a Landsat 8 image to be used for prediction.
  // image1991 = image1991.select(bands);
  image2001 = image2001.select(bands);
  image2011 = image2011.select(bands);

  // Load training points. The numeric property 'class' stores known labels.
  var points = builtup.merge(nonbuiltup);

  // Overlay the points on the imagery to get training.
  // var training1991 = image1991.sampleRegions({
  //   collection: points,
  //   properties: ['class'],
  //   scale: 30
  // });
  var training2001 = image2001.sampleRegions({
    collection: points,
    properties: ['class'],
    scale: 30
  });
  var training2011 = image2011.sampleRegions({
    collection: points,
    properties: ['class'],
    scale: 30
  });

  // Train a CART classifier with default parameters.
  // var trained1991 = ee.Classifier.cart().train(training1991, 'class', bands);
  var trained2001 = ee.Classifier.cart().train(training2001, 'class', bands);
  var trained2011 = ee.Classifier.cart().train(training2011, 'class', bands);

  // Classify the image with the same bands used for training.
  // var classified1991 = image1991.select(bands).classify(trained1991).clip(roi);
  var classified2001 = image2001.select(bands).classify(trained2001).clip(roi);
  var classified2011 = image2011.select(bands).classify(trained2011).clip(roi);

  // Display the inputs and the results.
  // Map.addLayer(classified1991, {min: 0, max: 1, palette: ['FF0000','00FF00']}, '1991 classification');
  Map.addLayer(classified2001, {min: 0, max: 1, palette: ['FF0000','00FF00']}, '2001 classification');
  Map.addLayer(classified2011, {min: 0, max: 1, palette: ['FF0000','00FF00']}, '2011 classification');



  var area = ee.Image.pixelArea();

  // //1991 Built up area
  // var builtup_classfication = classified1991.select('classification').eq(0);
  // builtup_classfication = builtup_classfication.updateMask(builtup_classfication);
  // var builtup_classfication_area = builtup_classfication.multiply(area).rename('builtup_classfication_area');
  // var stats_builtup = builtup_classfication_area.reduceRegion({
  //     reducer: ee.Reducer.sum(), 
  //     geometry: roi, 
  //     scale: 30,
  //   });
  // var builtup1991_areaKm = ee.Number(stats_builtup.get('builtup_classfication_area')).divide(1000000);
  // print('1991 Built up Area', builtup1991_areaKm);

  // //1991 Non Built up area
  // var nonbuiltup_classfication = classified1991.select('classification').eq(1);
  // nonbuiltup_classfication = nonbuiltup_classfication.updateMask(nonbuiltup_classfication);
  // var nonbuiltup_classfication_area = nonbuiltup_classfication.multiply(area).rename('nonbuiltup_classfication_area');
  // var stats_nonbuiltup = nonbuiltup_classfication_area.reduceRegion({
  //     reducer: ee.Reducer.sum(), 
  //     geometry: roi, 
  //     scale: 30,
  //   });
  // var nonbuiltup1991_areaKm = ee.Number(stats_nonbuiltup.get('nonbuiltup_classfication_area')).divide(1000000);
  // print('1991 Non Built up Area', nonbuiltup1991_areaKm);

  // var areaKm = ee.Number(0);
  // print('1991 Total Area: ', areaKm.add(builtup1991_areaKm).add(nonbuiltup1991_areaKm));  

  //2001 Built up area
  var builtup_classfication = classified2001.select('classification').eq(0);
  builtup_classfication = builtup_classfication.updateMask(builtup_classfication);
  var builtup_classfication_area = builtup_classfication.multiply(area).rename('builtup_classfication_area');
  var stats_builtup = builtup_classfication_area.reduceRegion({
      reducer: ee.Reducer.sum(), 
      geometry: roi, 
      scale: 30,
    });
  var builtup2001_areaKm = ee.Number(stats_builtup.get('builtup_classfication_area')).divide(1000000);
  print('2001 Built up Area', builtup2001_areaKm);

  //2001 Non Built up area
  var nonbuiltup_classfication = classified2001.select('classification').eq(1);
  nonbuiltup_classfication = nonbuiltup_classfication.updateMask(nonbuiltup_classfication);
  var nonbuiltup_classfication_area = nonbuiltup_classfication.multiply(area).rename('nonbuiltup_classfication_area');
  var stats_nonbuiltup = nonbuiltup_classfication_area.reduceRegion({
      reducer: ee.Reducer.sum(), 
      geometry: roi, 
      scale: 30,
    });
  var nonbuiltup2001_areaKm = ee.Number(stats_nonbuiltup.get('nonbuiltup_classfication_area')).divide(1000000);
  print('2001 Non Built up Area', nonbuiltup2001_areaKm);

  var areaKm = ee.Number(0);
  print('2001 Total Area: ', areaKm.add(builtup2001_areaKm).add(nonbuiltup2001_areaKm)); 
  
  //2011 Built up area
  builtup_classfication = classified2011.select('classification').eq(0);
  builtup_classfication = builtup_classfication.updateMask(builtup_classfication);
  builtup_classfication_area = builtup_classfication.multiply(area).rename('builtup_classfication_area');
  stats_builtup = builtup_classfication_area.reduceRegion({
      reducer: ee.Reducer.sum(), 
      geometry: roi, 
      scale: 30,
    });
  var builtup2011_areaKm = ee.Number(stats_builtup.get('builtup_classfication_area')).divide(1000000);
  print('2011 Built up Area', builtup2011_areaKm);

  //2011 Non Built up area
  nonbuiltup_classfication = classified2011.select('classification').eq(1);
  nonbuiltup_classfication = nonbuiltup_classfication.updateMask(nonbuiltup_classfication);
  nonbuiltup_classfication_area = nonbuiltup_classfication.multiply(area).rename('nonbuiltup_classfication_area');
  stats_nonbuiltup = nonbuiltup_classfication_area.reduceRegion({
      reducer: ee.Reducer.sum(), 
      geometry: roi, 
      scale: 30,
    });
  var nonbuiltup2011_areaKm = ee.Number(stats_nonbuiltup.get('nonbuiltup_classfication_area')).divide(1000000);
  print('2011 Non Built up Area', nonbuiltup2011_areaKm);

  areaKm = ee.Number(0);
  print('2011 Total Area: ', areaKm.add(builtup2011_areaKm).add(nonbuiltup2011_areaKm)); 
  
  // Create a task that you can launch from the Tasks tab.
  // Export.image.toDrive({
  //   image: classified1991,
  //   description: 'classified1991',
  //   scale: 30,
  //   region: roi
  // });
  
  // Export.image.toDrive({
  //   image: classified2001,
  //   description: 'classified2001',
  //   scale: 30,
  //   region: roi
  // });

  // Export.image.toDrive({
  //   image: classified2011,
  //   description: 'classified2011',
  //   scale: 30,
  //   region: roi
  // });

  // Map.addLayer(roi);
  // COMMENT TILL HERE
};

//Input: Latitude and Longitude (2 decimal places) of upper left and lower right corner 
calculate('Sakib', 'Hatiya',  22.39, 91.04, 22.08, 91.19);